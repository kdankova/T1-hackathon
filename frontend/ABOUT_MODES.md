# Режимы работы интерфейсов

## Два основных режима

### 1. 🖥️ Streamlit режим (основной)

**Что это:**
Полноценные веб-приложения на Streamlit, работающие на отдельных портах.

**Интерфейсы:**
- **Оператор** - `operator_app.py` на порту 8501
- **Модератор** - `moderator_app.py` на порту 8502

**Как работает:**
```
Браузер → http://localhost:8501 → Streamlit оператора
Браузер → http://localhost:8502 → Streamlit модератора
```

**Одновременная работа:**
✅ **ДА!** Можно открыть оба интерфейса в разных окнах/вкладках:
- Окно 1: http://localhost:8501 (оператор)
- Окно 2: http://localhost:8502 (модератор)
- Окно 3: http://localhost:8501 (второй оператор)

Каждое окно - это независимая сессия!

**Преимущества:**
- Полный функционал
- Удобная навигация
- Статистика и графики
- Автообновление при изменениях

**Горячие клавиши:**
- `R` - обновить интерфейс
- `C` - очистить кэш

---

### 2. 📌 iframe режим (bookmarklet / embed)

**Что это:**
Лёгкая панель (`embed.html`), которая встраивается в **любую веб-страницу** через bookmarklet.

**Как работает:**
```
1. Вы на странице CRM/тикет-системы
2. Нажимаете bookmarklet
3. Справа появляется сайд-панель с RAG интерфейсом
4. Работаете с RAG не покидая текущую страницу!
```

**Use case:**
Оператор работает в Zendesk/Freshdesk/ServiceNow:
```
┌─────────────────────────────────┬────────────┐
│                                 │   RAG      │
│   Тикет клиента                 │   панель   │
│   ================                │            │
│                                 │ [вопрос]   │
│   "Как стать клиентом           │            │
│    банка онлайн?"               │ [найти]    │
│                                 │            │
│   [Reply button]                │ [ответ]    │
│                                 │            │
│                                 │ [отправить]│
└─────────────────────────────────┴────────────┘
```

**Преимущества:**
- Не нужно переключаться между вкладками
- Копируешь вопрос из тикета → вставляешь в RAG → получаешь ответ
- Панель всегда под рукой

**Горячие клавиши:**
- `Cmd+Shift+K` (Mac) - скрыть/показать панель
- `Cmd+Enter` - копировать ответ
- `Esc` - очистить

**Установка bookmarklet:**

1. Запустите embed сервер:
```bash
cd frontend
python -m http.server 8080
```

2. Создайте закладку в браузере Arc:
   - Нажмите `Cmd+D`
   - В поле URL вставьте:
   ```javascript
   javascript:(function(){var s=document.createElement('script');s.src='http://localhost:8080/embed.js';document.body.appendChild(s);})();
   ```
   - Сохраните как "RAG Support"

3. Откройте любой сайт (например, gmail.com)
4. Выделите текст (необязательно)
5. Нажмите закладку "RAG Support"
6. Справа появится панель!

---

## Сравнение режимов

| Критерий | Streamlit режим | iframe режим |
|----------|----------------|--------------|
| **Использование** | Открыть в браузере отдельно | Встроить в любую страницу |
| **Функционал** | ⭐⭐⭐⭐⭐ Полный | ⭐⭐⭐ Базовый |
| **Одновременно** | ✅ Сколько угодно окон | ✅ Одна панель на страницу |
| **Интеграция** | Не требуется | Bookmarklet / iframe |
| **Горячие клавиши** | Streamlit встроенные | Cmd+Shift+K, Cmd+Enter |
| **Модератор** | ✅ Есть (port 8502) | ❌ Только оператор |
| **Статистика** | ✅ Полная | ❌ Нет |
| **Diff правок** | ✅ Визуальный | ❌ Нет |

---

## Когда что использовать?

### Streamlit режим подходит для:
✅ Работы операторов в call-центре с выделенным интерфейсом  
✅ Модераторов (только Streamlit!)  
✅ Просмотра статистики и аналитики  
✅ Обучения новых сотрудников  
✅ Внутренних инструментов компании  

### iframe режим подходит для:
✅ Интеграции в существующие CRM/тикет-системы  
✅ Операторов, которые работают в нескольких системах одновременно  
✅ Быстрого доступа через bookmarklet  
✅ Когда не хочется переключаться между вкладками  
✅ Демо и презентаций ("работает на любом сайте!")  

---

## Работа с двумя окнами одновременно

### Сценарий 1: Оператор + Модератор

```
Монитор 1:                    Монитор 2:
┌─────────────────┐          ┌─────────────────┐
│ Оператор        │          │ Модератор       │
│ localhost:8501  │          │ localhost:8502  │
│                 │          │                 │
│ [вопрос]        │          │ [правки queue]  │
│ [ответ]         │    →     │ [approve/reject]│
│ [send feedback] │          │                 │
└─────────────────┘          └─────────────────┘
```

### Сценарий 2: Два оператора

```
Окно 1:                      Окно 2:
┌─────────────────┐          ┌─────────────────┐
│ Оператор 1      │          │ Оператор 2      │
│ localhost:8501  │          │ localhost:8501  │
│                 │          │                 │
│ Клиент А        │          │ Клиент Б        │
└─────────────────┘          └─────────────────┘
```

Каждое окно - отдельная Streamlit сессия с собственным состоянием!

### Сценарий 3: Streamlit + iframe

```
┌──────────────────────────────────────┐
│ Тикет-система (основное окно)        │
│                                      │
│  ┌────────────────┬─────────────┐   │
│  │ Тикет #12345   │  RAG панель │   │
│  │                │  (iframe)   │   │
│  │ [текст тикета] │  [поиск]    │   │
│  │                │  [ответ]    │   │
│  └────────────────┴─────────────┘   │
└──────────────────────────────────────┘

Окно 2 (отдельная вкладка):
┌──────────────────────────────────────┐
│ Streamlit Модератор                  │
│ localhost:8502                       │
│                                      │
│ [просмотр всех правок от операторов] │
└──────────────────────────────────────┘
```

---

## FAQ

**Q: Нужен ли мне bookmarklet, если я использую Streamlit?**  
A: Нет, это опциональная фича для интеграции в сторонние системы.

**Q: Можно ли использовать оба режима одновременно?**  
A: Да! Например, операторы работают через iframe в CRM, а модераторы через Streamlit.

**Q: Почему горячие клавиши не работают в Streamlit?**  
A: В Streamlit используйте встроенные клавиши (`R`, `C`). Кастомные горячие клавиши (Cmd+Shift+K) работают только в iframe режиме.

**Q: Как проверить, что горячие клавиши работают в Arc на Mac?**  
A: 
1. Запустите: `python -m http.server 8080` в папке frontend
2. Откройте любой сайт в Arc
3. Запустите bookmarklet
4. Нажмите `Cmd+Shift+K` - панель должна скрыться/показаться

**Q: Bookmarklet не работает на некоторых сайтах**  
A: Некоторые сайты блокируют внешние скрипты через Content-Security-Policy. Это нормально и ожидаемо для безопасности.

